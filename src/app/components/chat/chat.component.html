<div class="chat-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="user-info">
      <div class="user-avatar">{{ getInitials(currentUser.pseudo) }}</div>
      <div class="user-name">{{ currentUser.pseudo }}</div>
      <button class="change-pseudo-btn" (click)="openChangePseudoPopup()">
        <i class="fas fa-edit"></i> ‚úèÔ∏è
      </button>
    </div>
    <div class="channels-header">
      <span>SALONS</span>
      <button class="add-channel-btn" (click)="openAddChannelPopup()">+</button>
    </div>
    <ul class="channels-list">
      <li *ngFor="let item of channelNames | keyvalue"
          [class.active]="currentChannel === item.key"
          [class.default-channel]="isDefaultChannel(item.key)">
        <div class="channel-container" (click)="changeChannel(item.key)">
          <span class="channel-name" (click)="changeChannel(item.key)">{{ item.value }}</span>
          <span class="delete-channel" *ngIf="!isDefaultChannel(item.key)"
                (click)="deleteChannel(item.key)">üóëÔ∏è</span>
        </div>
      </li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="chat-header">
      <div class="current-channel-name"># <span>{{ channelNames[currentChannel] }}</span></div>
    </div>
    <div class="messages-container" #messagesContainer>
      <div *ngFor="let msg of channelMessages[currentChannel]"
           class="message"
           [class.my-message]="msg.author === currentUser.pseudo">
        <div class="message-header">
          <div class="message-author">{{ msg.author }}</div>
          <div class="message-time">
            {{ msg.time | date:'HH:mm' }}
          </div>
        </div>
        <div class="message-content">{{ msg.content }}</div>
      </div>
    </div>
    <div class="message-input-container">
      <textarea class="message-input"
                #messageInput
                placeholder="√âcrivez votre message..."
                (keypress)="onKeyPress($event)"></textarea>
      <button class="send-button" (click)="sendMessage()">Envoyer</button>
    </div>
  </div>
</div>

<!-- Change Pseudo Popup -->
<div class="popup-overlay" *ngIf="showChangePseudoPopup">
  <div class="popup">
    <h3>Changer de pseudo</h3>
    <input type="text" [(ngModel)]="newPseudo" placeholder="Nouveau pseudo">
    <div class="popup-buttons">
      <button class="popup-button cancel-button" (click)="showChangePseudoPopup = false">Annuler</button>
      <button class="popup-button confirm-button" (click)="confirmChangePseudo()">Confirmer</button>
    </div>
  </div>
</div>

<!-- Add Channel Popup -->
<div class="popup-overlay" *ngIf="showAddChannelPopup">
  <div class="popup">
    <h3>Ajouter un salon</h3>
    <input type="text" [(ngModel)]="newChannelName" placeholder="Nom du salon">
    <div class="popup-buttons">
      <button class="popup-button cancel-button" (click)="showAddChannelPopup = false">Annuler</button>
      <button class="popup-button confirm-button" (click)="addChannel()">Ajouter</button>
    </div>
  </div>
</div>
