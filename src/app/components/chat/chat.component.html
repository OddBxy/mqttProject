<div class="chat-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="user-info">
      <div class="user-avatar">{{ getInitials(currentUser.pseudo) }}</div>
      <div class="user-name">{{ currentUser.pseudo }}</div>
      <button class="change-pseudo-btn" (click)="openChangePseudoPopup()">
        <i class="fas fa-edit">✏️</i>
      </button>
    </div>
    <div class="channels-header">
      <span>SALONS</span>
      <button class="add-channel-btn" (click)="openAddChannelPopup()">
        <span class="plus-icon">+</span>
      </button>
    </div>
    <ul class="channels-list">
      <li *ngFor="let item of channelNames | keyvalue"
          [class.active]="currentChannel === item.key"
          [class.default-channel]="isDefaultChannel(item.key)">
        <div class="channel-container" (click)="changeChannel(item.key)">
          <div class="channel-info">
            <span class="channel-icon">#</span>
            <span class="channel-name">{{ item.value }}</span>
          </div>
          <span class="delete-channel" *ngIf="!isDefaultChannel(item.key)"
                (click)="deleteChannel(item.key)">
            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
              <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </span>
        </div>
      </li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="chat-header">
      <div class="current-channel-info">
        <div class="current-channel-name">
          <span class="channel-hash">#</span>
          <span>{{ channelNames[currentChannel] }}</span>
        </div>
      </div>
    </div>
    <div class="messages-container" #messagesContainer>
      <div *ngFor="let msg of channelMessages[currentChannel]; let i = index; let isFirst = first"
           class="message-wrapper"
           [class.first-message]="isFirst || channelMessages[currentChannel][i-1]?.author !== msg.author">
        <div class="message"
             [class.my-message]="msg.author === currentUser.pseudo"
             [class.system-message]="msg.isSystem">
          <div class="message-header" *ngIf="isFirst || channelMessages[currentChannel][i-1]?.author !== msg.author">
            <div class="message-author-avatar" *ngIf="!msg.isSystem">{{ getInitials(msg.author) }}</div>
            <div class="message-author-info">
              <div class="message-author">{{ msg.author }}</div>
              <div class="message-time">
                {{ msg.time | date:'HH:mm' }}
              </div>
            </div>
          </div>
          <div class="message-content">{{ msg.content }}</div>
        </div>
      </div>
    </div>
    <div class="message-input-container">
      <div class="message-input-wrapper">
        <textarea class="message-input"
                  #messageInput
                  placeholder="Écrivez votre message..."
                  (keypress)="onKeyPress($event)"></textarea>
        <button class="send-button" (click)="sendMessage()">
          <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Change Pseudo Popup -->
<div class="popup-overlay" *ngIf="showChangePseudoPopup">
  <div class="popup">
    <h3>Changer de pseudo</h3>
    <input type="text" [(ngModel)]="newPseudo" placeholder="Nouveau pseudo">
    <div class="popup-buttons">
      <button class="popup-button cancel-button" (click)="showChangePseudoPopup = false">Annuler</button>
      <button class="popup-button confirm-button" (click)="confirmChangePseudo()">Confirmer</button>
    </div>
  </div>
</div>

<!-- Add Channel Popup -->
<div class="popup-overlay" *ngIf="showAddChannelPopup">
  <div class="popup">
    <h3>Ajouter un salon</h3>
    <input type="text" [(ngModel)]="newChannelName" placeholder="Nom du salon">
    <div class="popup-buttons">
      <button class="popup-button cancel-button" (click)="showAddChannelPopup = false">Annuler</button>
      <button class="popup-button confirm-button" (click)="addChannel()">Ajouter</button>
    </div>
  </div>
</div>
